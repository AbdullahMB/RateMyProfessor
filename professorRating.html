<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Professor</title>


      <!-- Compiled and minified CSS -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css">
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <link rel="stylesheet" href="MyStyle.css">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"></script>
      <script src="jquery.cookie.js" type="text/javascript"></script>

      <script>
      $(document).ready(function(){
          $('select').material_select();
          $('#textarea1').trigger('autoresize');
        });
      </script>

  </head>
  <body>
    <script type="text/javascript">


        var getUrlParameter = function getUrlParameter(sParam) {
          var sPageURL = decodeURIComponent(window.location.search.substring(1)),
              sURLVariables = sPageURL.split('&'),
              sParameterName,
              i;

          for (i = 0; i < sURLVariables.length; i++) {
              sParameterName = sURLVariables[i].split('=');

              if (sParameterName[0] === sParam) {
                  return sParameterName[1] === undefined ? true : sParameterName[1];
              }
          }
      };
      var pid = getUrlParameter('id');
      console.log(pid);
      function currentURL(){
        return "http://localhost:3000/api/user/review/professor/"+pid;
      }

      window.onload = function() {
          document.stupidForm.action = currentURL();
      }


    </script>
    <!-- top bar -->
    <nav>
    <div class="nav-wrapper teal lighten-0">
      <a href="home.html" class="brand-logo">&nbspRateMyProfesor</a>
      <ul class="right hide-on-med-and-down">
      <li class="logged"><a href="Login.html">Login</a></li>
     <li class="logged"><a href="signUp.html">Signup</a></li>
     <li class="LOut" ><a onclick="logout()"></option>Sign Out</a></li>

     <!-- Dropdown Trigger -->
    </ul>
      <ul class="right hide-on-med-and-down">
        <li><a href="explore.html"><i class="material-icons left">search</i>Find a Professor</a></li>
      </ul>

    </div>
  </nav><!--End of top bar-->

  <br>

  <div class="row center">
   <div class="col s4">
     <img src="professor_Image.jpg" width="250px"alt="Professor">

   </div>
   <div class="col s4 center">
     <br>
     <br>
     <i class=" medium material-icons center icon-lighten">perm_identity</i>
     <p class="ProfDetails">Name: <b id="ProfName" class="profInsideDetails"></b></p>
     <p class="ProfDetails">University: <b id="ProdUniversity" class="profInsideDetails"></b></p>
     <p class="ProfDetails">Department: <b id="ProfDepartment" class="profInsideDetails"></b></p>

   </div>

   <div class="col s4 center">
     <br>
     <br>
     <i class="medium material-icons icon-lighten">thumbs_up_down</i>
     <p class="ProfDetails">Overall Rating: <br><b id="OverAllRating" style=" font-size: 300%;color:black">4.5</b>/5</p>
     <p class="ProfDetails">Difficulty: <br><b id="Difficulty" style=" font-size: 150%;color:black">4.1</b>/5</p>
   </div>
   <hr>
 </div>

<!--Comments Section-->
<p class="Headers11">&nbsp&nbsp&nbsp <b>Comments: </b></p>

 <div class="row" id="PDiv">


  </div>
        </div>
      </div>

    </div>


    <hr>

    <!--Write a comment-->
    <div class="row ">
         <p id ="hide2"class="Headers11">&nbsp&nbsp&nbsp <b>Rate This Professor: </b></p>
         <div id ="hide"class="col s12 m12">
           <div class="card  blue-grey darken-1">
             <div class="card-content white-text">
               <form name="stupidForm" id="reviewForm" method="post">

               <div class="input-field col s12">
                 <input value="" id="UserSubject" type="text" class="validate" name="title" required>
                 <label class="active" for="UserSubject">Write your subject here...</label>
               </div>



                   <div class="row">
                     <div class="input-field col s12">
                       <textarea name="comments" id="UserComments" form="reviewForm" class="materialize-textarea" required></textarea>
                       <label for="UserComments">Write your comments here...</label>
                </div>
              </div>



             </div>
             <div class="card-action">

            <div class="input-field col s6">
               <select id="overallrating-Selection" form="reviewForm" name="rating">
                 <option value="" disabled selected>Choose overall quality</option>
                 <option value="1">Worst Professor</option>
                 <option value="2">Professor Get's F too</option>
                 <option value="3">Mediocre</option>
                 <option value="4">Solid Chice</option>
                 <option value="5">Best Professor</option>
               </select>
               <label>Overall</label>
             </div>

             <div class="input-field col s6">
                <select id="difficulty-Selection" form="reviewForm" name="difficulty">
                  <option value="" disabled selected>Choose difficulty</option>
                  <option value="1">Come and you'll pass</option>
                  <option value="2">Easy A</option>
                  <option value="3">Average grade</option>
                  <option value="4">A lot of work</option>
                  <option value="5">Difficult to Pass</option>
                </select>
                <label>Difficulty</label>
              </div>


              <button type="submit" id="review" form="reviewForm" class="btn-floating right btn-large waves-effect waves-light teal lighten-1"><i class="material-icons">add</i></button>
                <p>&nbsp</p>
                <p>&nbsp</p>
                </form>
             </div>
           </div>
         </div>

       </div>

       <!--Footer-->
    <footer class="page-footer white">
              <div class="container">
                <div class="row">
                  <div class="col l6 s12">
                    <h5 class="white-text">Footer Content</h5>
                    <p class="teal-text text-lighten-0">This website was created on 2017-05-29.</p>
                  </div>
                  <div class="col l4 offset-l2 s12">
                    <h5 class="teal-text text-lighten-0">Our team:</h5>
                    <ul>
                      <li><a class="teal-text text-lighten-0" href="#!">Ahmed AlQarni</a></li>
                      <li><a class="teal-text text-lighten-0" href="#!">Abdullah Babaier</a></li>
                      <li><a class="teal-text text-lighten-0" href="#!">Waleed Humayed</a></li>
                      <li><a class="teal-text text-lighten-0" href="#!">Ibrahim Alshaya</a></li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="footer-copyright teal lighten-0">
                <div class="container">
                <a class="white-text right" href="#!">More Links</a>
                </div>
              </div>
            </footer>

       <script>
       if (!!$.cookie('jwt')) {

       $(".logged").hide();
       $(".LOut").show();

       console.log("hiiiiiiiiii");
     }else {
       $(".LOut").hide();
       $("#hide").hide();
       $("#hide2").text( " Signin to Rate This Professor");

     }
     function logout(){

       $.removeCookie('jwt', { path: '/' });

     window.location="home.html" ;

     }

           var getUrlParameter = function getUrlParameter(sParam) {
             var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                 sURLVariables = sPageURL.split('&'),
                 sParameterName,
                 i;

             for (i = 0; i < sURLVariables.length; i++) {
                 sParameterName = sURLVariables[i].split('=');

                 if (sParameterName[0] === sParam) {
                     return sParameterName[1] === undefined ? true : sParameterName[1];
                 }
             }
           };
           var pid = getUrlParameter('id');

           function goBack(){
             return "ProfessorPage.html?id="+pid;// location.href = "ProfessorPage.html?id="+pid;
           }

           var jqxhr_professor = $.get( "http://localhost:3000/api/professor/"+pid, function(data) {
             var professor = data;
             console.log(professor);
               $('#ProfName').text(professor.name);
               $('#ProdUniversity').text(professor.university);
               $('#ProfDepartment').text(professor.department);
           });
          var jqxhr_ratings = $.get( "http://localhost:3000/api/reviews/professor/"+pid, function(data_rate) {
             var rate = data_rate;
             console.log(rate);


             var sumRatings_rating=0;
             var sumRatings_difficulty=0;

             for(var i=0; i<rate.length;i++){
               sumRatings_rating=sumRatings_rating+rate[i].rating;
               sumRatings_difficulty=sumRatings_difficulty+rate[i].difficulty;
               $('#PDiv').append('\
               <div class="col s12 m6">\
                 <div class="card blue-grey darken-1">\
                   <div class="card-content white-text">\
                     <span class="card-title">'+rate[i]["title"]+'</span>\
                     <p">'+rate[i]["comments"]+'</p>\
                   </div>\
                   <div class="card-action">\
                     <span>Overall Rating: <b style="font-size:180%">'+rate[i]["rating"]+'</b></span>\
                     <span>&nbsp&nbsp&nbsp&nbsp&nbsp Difficulty: <b style="font-size:120%">'+rate[i]["difficulty"]+'</b></span>\
                   </div>\
                 </div>\
               </div>\
                              ');
             }


             var average_ratings=Math.round((sumRatings_rating/rate.length)*100)/100;
             var average_difficulty=Math.round((sumRatings_difficulty/rate.length)*100)/100;


             if(isNaN(average_ratings)){
               $('#OverAllRating').text("NA");
               $('#Difficulty').text("NA");
             }else{
               $('#OverAllRating').text(average_ratings);
               $('#Difficulty').text(average_difficulty);
             }
       });


       /*$("#review").click(function(){
         console.log("I am in!");
         $.post('http://localhost:3000/api/user/review/professor/'+pid, $('#reviewForm').serialize(), function(){
           document.location.href = 'home.html';		// if success
         })

       })*/
       </script>


  </body>



</html>
